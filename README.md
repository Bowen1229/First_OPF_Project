# 初次尝试OPF项目说明


---

本项目初步采用一个自构造的三节点电力系统（~/data/3bus.json），其目的是便于手动验证潮流计算结果的正确性。

系统特征：

包含 3 个母线（1 个 Slack，2 个 PQ）；

各节点负荷与支路阻抗数据为人为设定；

不考虑发电机约束、电压上下限、线路功率限制等优化约束，仅用于测试牛顿法框架的收敛行为。

---
本项目通过五个递进模块，逐步实现电力系统的潮流计算与最优潮流（OPF）问题求解，涵盖从电网建模、功率平衡方程建立、牛顿法数值迭代到基于 Gurobi 的最优化建模与求解的完整过程，所有核心源代码位于 src/ 目录中，辅助知识整理于 notebooks/下。下面是五个主要代码的详细介绍：


## build_ybus.py：Ybus 构建与系统建模

**学习目标：**
- 理解电网拓扑结构中母线与支路的基本概念；
- 从支路阻抗数据构建导纳矩阵 Ybus；
- 理解 Ybus 的对称性（物理电路的可逆性）与复数元素物理含义。

**实现：**
- `data/3bus.json`：三节点系统的网络描述文件；
- `build_Ybus()` 函数：基于 JSON 数据生成 Ybus；
- 控制台输出 Ybus 。

---

## power_mismatch.py：潮流平衡方程与功率不平衡计算

**学习目标：**
- 理解潮流方程中电压（幅值与相角）与节点功率之间的关系；
- 用代码实现有用和无功注入功率计算公式；
- 在给定初始电压估计下，计算各 $P$ $Q$ 节点的$\Delta P$ 和 $\Delta Q$不平衡量；

**实现：**
- 控制台输出 $\Delta P$ 与 $\Delta Q$；


---

## newton_solver.py：牛顿-拉夫森潮流求解器

**学习目标：**
- 构建潮流方程的雅可比矩阵（$J$），包括四个子块 $J1$ ~ $J4$；
- 学习用代码实现牛顿法迭代；
- 持续更新电压直到不平衡量低于误差阈值；
- 输出最终每个母线的电压幅值与相角。

**实现：**

- **newton_solver.py**：潮流计算核心模块
该模块实现了牛顿-拉夫森（Newton-Raphson）算法求解一个电力系统中各母线（Bus）的电压幅值$|V|$与相角$\theta$。包含以下功能函数：
    - `calculate_power_mismatch`: 根据当前节点电压估计值，计算有功/无功功率不平衡量。
    - `build_jacobian`:构建潮流方程的雅可比矩阵，用于线性化功率平衡方程。
    - `solve_powerflow`:这是整个程序的主函数，使用牛顿迭代方法，执行迭代流程： 初始化电压 $|V|$与相角$\theta$，计算当前不平衡量 $Delta P$, $Delta Q$ 构建雅可比矩阵 J 解线性系统：$$J\cdot\Delta x= \begin{bmatrix} \Delta P \\ \Delta Q \end{bmatrix}$$
    - 更新变量：对 PQ 节点进行更新： $$\theta_𝑖^{( 𝑘 + 1 )} = \theta_𝑖 ^{( 𝑘 )} + \Delta \theta_𝑖\\V_𝑖^{( 𝑘 + 1 )} = V_𝑖 ^{( 𝑘 )} + \Delta V_𝑖$$
    - 判断是否收敛，如果最大不平衡量 < tol，停止迭代。
- **test_newton_solver.py**:测试脚本
该脚本作为主程序入口，主要用于测试 newton_solver.py 中实现的潮流求解逻辑。它打印各节点最终的电压幅值与相角，用于验证求解效果与收敛性。

---

## visualize_powerflow.py：潮流结果可视化与结构重构

**学习目标：**
- 模块化拆分潮流代码结构；
- 将潮流计算结果进行输出或绘图（如节点电压分布）；
- 准备结构接口用于 OPF 输入数据；
- 构造新的网络描述文件（包含发电机）供 OPF 使用。

**实现：**
- `data/3bus_with_gen.json`：带发电机模型的数据；
- 可视化图或表格；
- 可用于 OPF 的数据结构字典。

---

## opf_linear.py：线性最优潮流（OPF）建模与求解

**学习目标：**
- 理解最优潮流（OPF）问题的基本形式；
- 构建线性目标函数（如发电成本）与约束（功率平衡、发电机上下限、电压上下限）；
- 输出最优发电计划与节点电压。

**实现：**

- 构建并求解一个最简单的线性最优潮流问题
    输入：
    - `n_gen`发电机数量
    - `pmin, pmax`每台发电机的最小和最大出力（列表）
    - `cost`: 每台发电机的单位发电成本（列表）
    - `load`: 总系统负荷（标量）

    输出：
    - `result`: 字典，包含每台发电机出力和最小成本

- 将OPF模型封装成一个可调用的函数，使其具备模块化、复用性和可扩展性
